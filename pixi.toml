[workspace]
name = "your-project-name"
version = "0.1.0"
description = "A modern Python project with best practices"
channels = ["conda-forge"]
platforms = ["linux-64", "osx-64", "osx-arm64", "win-64"]

[dependencies]
# åŸºç¡€ä¾èµ–ï¼ˆä¸æŒ‡å®š Python ç‰ˆæœ¬ï¼Œè®©å„ç¯å¢ƒè‡ªå·±å†³å®šï¼‰
uv = ">=0.1.0"

[feature.dev.dependencies]
pytest = ">=8.0"
pytest-cov = ">=4.1"
ruff = ">=0.3"
mypy = ">=1.8"
pre-commit = ">=3.6"
bandit = ">=1.7.5"
tox = ">=4.0"        # ç”¨äºå¤šç‰ˆæœ¬æµ‹è¯•

[feature.docs.dependencies]
mkdocs = ">=1.5"
mkdocs-material = ">=9.5"
mkdocstrings-python = ">=1.7"

[feature.docs.pypi-dependencies]
your-package-name = { path = ".", editable = true }

# Python 3.12 ç¯å¢ƒï¼ˆæœ€ä½æ”¯æŒç‰ˆæœ¬ï¼‰
[feature.py312.dependencies]
python = "3.12.*"

# Python 3.13 ç¯å¢ƒ
[feature.py313.dependencies]
python = "3.13.*"

# Python 3.14 ç¯å¢ƒï¼ˆæœ€æ–°ï¼åˆšå‘å¸ƒ ğŸš€ï¼‰
[feature.py314.dependencies]
python = "3.14.*"

[environments]
# é»˜è®¤ç¯å¢ƒ - Python 3.14ï¼ˆæœ€æ–°ï¼ï¼‰
default = { features = ["dev", "py314"] }

# å¤šç‰ˆæœ¬æµ‹è¯•ç¯å¢ƒï¼ˆæ¯ä¸ªç‰ˆæœ¬ç‹¬ç«‹ solve-groupï¼‰
py312 = { features = ["dev", "py312"] }
py313 = { features = ["dev", "py313"] }
py314 = { features = ["dev", "py314"] }

# æ–‡æ¡£ç¯å¢ƒ
docs = { features = ["docs", "py314"] }

# ç”Ÿäº§ç¯å¢ƒ
prod = { features = ["py314"] }

[tasks]
# ============================================================================
# æ ¸å¿ƒæ£€æŸ¥ä»»åŠ¡ï¼ˆæŒ‰ä¼˜å…ˆçº§æ’åºï¼‰
# ============================================================================

# 1. æ ¼å¼åŒ–ï¼ˆæœ€å¿«ï¼Œè‡ªåŠ¨ä¿®å¤ï¼‰
format = "ruff format src/ tests/ convo_sync.py"

# 2. Lint æ£€æŸ¥ï¼ˆå¿«é€Ÿï¼Œå‘ç°æ˜æ˜¾é—®é¢˜ï¼‰
lint = "ruff check src/ tests/ convo_sync.py"

# 3. ç±»å‹æ£€æŸ¥ï¼ˆä¸­é€Ÿï¼Œå‘ç°ç±»å‹é—®é¢˜ï¼‰
typecheck = "mypy src/ convo_sync.py"

# 4. å®‰å…¨æ£€æŸ¥ï¼ˆå¿«é€Ÿï¼Œå‘ç°å®‰å…¨é—®é¢˜ï¼‰
security = "bandit -r src/ convo_sync.py -ll"

# 5. å•å…ƒæµ‹è¯•ï¼ˆå½“å‰ç¯å¢ƒï¼‰
test = "python -m pytest tests/ -v --cov=src --cov-report=term-missing --cov-report=html -p no:requests_mock"

# ============================================================================
# å¤šç‰ˆæœ¬å…¼å®¹æ€§æ£€æŸ¥
# ============================================================================

# æ‰€æœ‰ç‰ˆæœ¬æµ‹è¯•ï¼ˆéœ€è¦æ‰‹åŠ¨æŒ‡å®šç¯å¢ƒè¿è¡Œï¼‰
# ä½¿ç”¨æ–¹å¼ï¼špixi run -e py312 test, pixi run -e py313 test, pixi run -e py314 test

# æ‰¹é‡è¿è¡Œæ‰€æœ‰ç‰ˆæœ¬æµ‹è¯•çš„è„šæœ¬
test-all-versions = """
echo '=== Testing Python 3.12 ===' && \
pixi run -e py312 test && \
echo '=== Testing Python 3.13 ===' && \
pixi run -e py313 test && \
echo '=== Testing Python 3.14 ===' && \
pixi run -e py314 test && \
echo '=== All Python versions tested successfully! ==='
"""

# Python ç‰ˆæœ¬ä¿¡æ¯
python-version = "python --version && python -c 'import sys; print(f\"Python {sys.version_info.major}.{sys.version_info.minor}.{sys.version_info.micro}\")'"

# æ˜¾ç¤ºæ‰€æœ‰ç¯å¢ƒçš„ Python ç‰ˆæœ¬
show-versions = """
echo '=== Python 3.12 ===' && pixi run -e py312 python-version && \
echo '=== Python 3.13 ===' && pixi run -e py313 python-version && \
echo '=== Python 3.14 ===' && pixi run -e py314 python-version
"""

# ============================================================================
# ç»„åˆæ£€æŸ¥ä»»åŠ¡
# ============================================================================

# å¿«é€Ÿæ£€æŸ¥ï¼ˆæœ¬åœ°å¼€å‘ç”¨ï¼Œåªæ£€æŸ¥å½“å‰ç¯å¢ƒï¼‰
check = { depends-on = ["format", "lint", "typecheck", "test"] }

# å®Œæ•´æ£€æŸ¥ï¼ˆæ¨é€å‰ï¼ŒåŒ…æ‹¬å®‰å…¨æ£€æŸ¥ï¼‰
check-all = { depends-on = ["format", "lint", "typecheck", "security", "test"] }

# å®Œæ•´å…¼å®¹æ€§æ£€æŸ¥ï¼ˆCI ç”¨ï¼Œæ‰€æœ‰ç‰ˆæœ¬ï¼‰
check-compat = { depends-on = [
    "format",
    "lint",
    "typecheck",
    "security",
    "test-all-versions",
] }

# ============================================================================
# å¼€å‘ä»»åŠ¡
# ============================================================================

# å®‰è£…ä¾èµ–
install = "uv sync --all-extras"

# è¿è¡Œæ¸…ç†
run-clean = "python convo_sync.py clean"

# è¿è¡Œè½¬æ¢
run-convert = "python convo_sync.py convert"

# è¿è¡Œå®Œæ•´ç®¡é“
run-pipeline = "python convo_sync.py pipeline"

# ============================================================================
# æ–‡æ¡£ä»»åŠ¡
# ============================================================================

docs-serve = "mkdocs serve"
docs-build = "mkdocs build"
docs-deploy = "mkdocs gh-deploy --force"

# ============================================================================
# Git Hooks
# ============================================================================

hooks-install = "pre-commit install"
hooks-run = "pre-commit run --all-files"

# ============================================================================
# æ„å»ºä»»åŠ¡
# ============================================================================

build = "uv build"
clean-build = "rm -rf build/ dist/ *.egg-info htmlcov/ .coverage .pytest_cache/ .mypy_cache/ .ruff_cache/"

# æ„å»ºå¹¶æ£€æŸ¥åŒ…
build-check = { depends-on = ["clean-build", "check-compat", "build"] }
